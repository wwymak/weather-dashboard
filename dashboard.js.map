{"version":3,"sources":["dashboard.es6.js"],"names":[],"mappings":"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","file":"dashboard.js","sourcesContent":["/**\n * Main file for the charting js\n *\n * idea: main chart to have temp as time series, grouped by day of year\n * possibly to be zoomable into minute detail, with rainfall superimposed as an extra series above\n * -- would be really cool to do something along the lines of http://bl.ocks.org/emeeks/b57f4cc89dacd38fcdcd\n *\n * (showing pattern in rainfall and temp, which most people are interested in\n * rainfall + temp so you can know whetehr it's generally cold and wet/ hot and wet, vice versa etc\n *\n *\n * secondary charts:\n * wind direction distrubution average for the date range selected with brush (radar chart)\n *\n * battery level vs solar flux\n *\n */\n\nlet dateFormatter = d3.time.format('%Y/%m/%d %H:%M');\nlet xFilter; //crossfilter\nlet dayDimension, solarFluxDimension, windDirDimension; //dimensions- basically what you want as x values\nlet dayTempGroup, rainFallGroup, windDirGroup; //xfilter groups\n\nlet tempChart, batteryChart, rainfallChart, windChart; // types of charts\nlet transitionDuration = 500; //default transition times for chart zooming etc\n\n/**\n * initialises the dashboard elements that dc draws, setting the height and width\n * dynamically so on window resize the chart redraws according to new dimensions\n */\nfunction dashboardInit() {\n  let tempChartWidth = document.getElementById('tempChart').offsetWidth,\n      tempChartHeight = tempChartWidth * 0.3,\n      rainFallChartWidth = document.getElementById('rainfallChart').offsetWidth,\n      rainFallChartHeight = rainFallChartWidth * 0.3;\n  tempChart = dc.lineChart('#tempChart')\n      .width(tempChartWidth)\n      //.minWidth(150)\n      .height(tempChartHeight)\n      //.minHeight(150)\n      .transitionDuration(transitionDuration)\n      .margins({top: 30, right: 50, bottom: 25, left: 40});\n  rainfallChart = dc.barChart('#rainfallChart')\n      .width(rainFallChartWidth)\n      .height(rainFallChartHeight)\n      .transitionDuration(10)\n      .margins({top: 30, right: 50, bottom: 25, left: 40});\n  //batteryChart = dc.lineChart('#batteryChart');\n}\n\n/**\n * get the csv data using d3.promise, then do a few bits of parsing\n * @returns {Promise.<T>}\n */\nfunction getData() {\n  return d3.promise.csv('JCMB_2015.csv').then(data => {\n    data.forEach(d => {\n      d.dateTime = dateFormatter.parse(d.dateTime);\n      Object.keys(d).forEach((key) => {\n        if (d.hasOwnProperty(key) && key !== \"dateTime\") {\n          d[key] = +d[key];\n        }\n      });\n      if(d.windDir >= 360) {\n        d.windDir = d.windDir % 360;\n      }\n      d.day = d3.time.day(d.dateTime);\n      d.windDirType = Math.floor(d.windDir / 45);//classify the wind direction into 1 of 8 quadrants\n    });\n    //data.forEach(d => {\n    //  d.month = d3.time.month(d.dateTime);\n    //  d.day = d3.time.day(d.dateTime);\n    //  d.hour = d3.time.hour(d.dateTime);\n    //  d.windDirType = Math.floor(d.windDir / 45); //classify the wind direction into 1 of 8 quadrantsa\n    //});\n\n    return data\n  }, (err) => {\n    alert(\"problem fetching data, please reload page\");\n  });\n}\n\nfunction setXfilter(data) {\n  xFilter = crossfilter(data);\n  dayDimension = xFilter.dimension(d => d.day);\n  solarFluxDimension = xFilter.dimension(d => d.solarFlux);\n  windDirDimension = xFilter.dimension(d => d.windDirType);\n  console.log(d3.max(data, d => d.windDir))\n\n  dayTempGroup = dayDimension.group().reduce((p, v) => {\n    ++p.count;\n    p.totalTemp += v.surfTemp;\n    p.avgTemp = p.totalTemp /p.count;\n    return p\n  }, (p,v) => {\n    --p.count;\n    p.totalTemp -= v.surfTemp;\n    p.avgTemp = p.totalTemp /p.count;\n    return p\n  }, () => {\n    return {\n      count: 0,\n      totalTemp: 0,\n      avgTemp: 0\n    }\n  });\n\n  rainFallGroup = dayDimension.group().reduceSum(d => d.rainfall);\n  windDirGroup = windDirDimension.group().reduceCount();\n}\n\nfunction chartRender(data){\n  let minDate = d3.min(data, d => d.dateTime),\n      maxDate = d3.max(data, d => d.dateTime);\n  tempChart\n      .dimension(dayDimension)\n      .group(dayTempGroup)\n      .brushOn(true)\n      .valueAccessor(d => d.value.avgTemp)\n      .x(d3.time.scale().domain([minDate, maxDate]))\n      .yAxisLabel('degrees Celcius')\n      .on('filtered', () => {\n        console.log('filtered')\n        d3.select('#windDirChart').datum(windDirGroup.all()).call(radarChart());\n      });\n\n  rainfallChart\n      .dimension(dayDimension)\n      .group(rainFallGroup)\n      .valueAccessor(d => d.value)\n      .yAxisLabel('mm')\n      .x(d3.time.scale().domain([minDate, maxDate]))\n      .elasticY(true)\n      .rangeChart(tempChart);\n\n  //console.log(windDirGroup.all())\n  windChart = d3.select('#windDirChart').datum(windDirGroup.all()).call(radarChart());\n  dc.renderAll();\n}\n\n//radarChart for windDirection data\nfunction radarChart(){\n  let width = 400,\n      height = 400,\n      margin = 40,\n      angleScale = d3.scale.linear().range([0, 2* Math.PI]),\n      radiusScale = d3.scale.linear().range([0, d3.min([height, width]) /2 - margin]),\n      colorScale = d3.scale.category20(); //temp colors-- don't look super great tbh,\n\n  let stackFunc = d3.layout.stack().values(d => d.values);\n\n  function chart(selection) {\n    let svg;\n    //assuming that data is in the format of array with [{key: .., value:...}, ...]\n    selection.each((data) => {\n      //select the svg if it exists\n      svg = this.selectAll(\"svg.radarchart\").data([data]);\n      console.log(data, svg)\n      //or add a new one if not\n      let newSVG = svg.enter().append('svg').attr('class', 'radarchart');\n\n      svg.attr(\"width\" , width)\n        .attr(\"height\", height);\n\n      angleScale.domain([0, data.length]);\n      radiusScale.domain([0, d3.max(data, d => d.value)]);\n\n      let radialG = newSVG.append('g').attr('class', 'radial-bars')\n          .attr('transform', 'translate(' +  width /2 + ',' + height/2 + ')');\n\n      drawRadialBars(data);\n\n      function drawRadialBars(data) {\n        let arc = d3.svg.arc().startAngle((d, i) => angleScale(i))\n            .endAngle((d, i) => angleScale(i + 1))\n            .innerRadius(0)\n            .outerRadius(d => radiusScale(d.value));\n        let radarSectors = radialG.selectAll('path').data(data)\n            radarSectors.enter().append('path');\n            radarSectors.attr('d', arc).attr('class', 'radial-sector')\n                .attr('fill', (d, i) => colorScale(i));\n      }\n\n    })\n  }\n\n  //getters and setters\n  chart.width = function(val) {\n    if (!arguments.length) {\n      return width;\n    }\n    width = val;\n    return chart;\n  };\n\n  chart.height = function(val) {\n    if (!arguments.length) {\n      return height;\n    }\n    height = val;\n    return chart;\n  };\n\n  chart.margin = function(val) {\n    if (!arguments.length) {\n      return margin;\n    }\n    margin = val;\n    return chart;\n  };\n\n  return chart\n}\n//todo dcjs don't seem to like the resizing very much...\nfunction windowResizeHandler() {\n  //debounce function, basically redraw the chart on resize but only after you've\n  //finished resizing\n  let resizeTimer;\n  window.onresize = ((e) => {\n    clearTimeout(resizeTimer);\n    resizeTimer = setTimeout(() => {\n      //dashboardInit();\n      dc.redrawAll();\n    }, 250);\n  });\n\n}\n\ndashboardInit();\n\ngetData().then(data => {\n  setXfilter(data);\n  return data}, err => {console.log(err)})\n  .then((data) => {chartRender(data)});"]}